<div class="container">
  <div class="row">
    <div class="col">
      <div class="container d-flex">
        <div class="col-6">
          <% if @memberids.include? current_user.id %>
            <div class="me-5">
              <%= link_to "back to group", group_path(@event.group), class: "btn btn-primary ml-3 w-100" %>
            </div>
          <% end %>
          <div class="me-5 p-3 my-3 rounded pb-4" style="background-color: #F4F4F4; border: 1px solid black;">
            <div class="card-product infos d-flex flex-column justify-content-center" style="height: auto;">
            <h3 class="mt-3"><%= @event.name %></h1>
            <h5>Location - <%= @event.location %></h5>
            <h6 class="mb-1">Description: <%= @event.description %></h6>
            <h6 class="mb-3 mt-1"><%= @event.start_date %> - <%= @event.end_date %></h6>
            </div>
            <h4 class="my-3 text-center">Attendees </h4>
            <div class="mx-3">
              <% @users.each do |user| %>
                <div class="d-flex my-3">
                  <% if user.photo.attached? %>
                    <%= cl_image_tag user.photo.key, class: "avatar", style: "height: 50px; width: 50px;" %>
                  <% end %>
                  <p class="pt-3 ms-3"><%= user == @event.group.user ? "Admin: " : "" %><%= user == current_user ? "You" : user.first_name.capitalize %></p>
                </div>
              <% end %>
            </div>
            <div class="mx-3">
              <% @eventusers.each do |user| %>
                <div class="d-flex mt-3">
                  <% if user.user.photo.attached? %>
                    <%= cl_image_tag user.user.photo.key, class: "avatar", style: "height: 50px; width: 50px;" %>
                  <% end %>
                  <p class="pt-3 ms-3"><%= user.user == current_user ? "You" : user.user.first_name.capitalize %></p>
                  <% if current_user == @event.group.user %>
                    <%= link_to "Kick", event_user_path(user), method: :delete, class: "btn btn-primary btn-sm mb-2 mt-3 ms-3" %>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        <%= simple_form_for([@group, @event, @event_user], remote: true) do |f| %>
        <div class="form-group pe-5">
            <%= f.association :user, label_method: :first_name, class: "form-control", placeholder: "Group name" %>
          <%= f.submit "Invite user", class: "btn btn-primary ml-3 w-100 mb-3" %>
        </div>
        <% end %>
        <div class="chatroom me-5" data-controller="event-subscription" data-event-subscription-event-id-value="<%= @event.id %>">
        <div style="background-color: #F4F4F4; border: 1px solid black;" class="p-3 mb-5 rounded">
          <div class="messages mb-3" data-event-subscription-target="messages">
            <% @event.messages.last(5).each do |message| %>
              <%= render "messages/message", message: message %>
            <% end %>
          </div>

          <%= simple_form_for [@group, @event, @message], remote: true,
            html: {data: {event_subscription_target: "form"}, class: "d-flex"}  do |f| %>
            <%= f.text_field :content,
              label: false,
              class: "w-100",
              placeholder: "Message ##{@event.name}",
              wrapper_html: {class: "flex-grow-1"}
            %>
            <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
            <%= f.submit "Send", class: "btn btn-primary btn-sm ms-2" %>
          <% end %>
        </div>
      </div>
      </div>
      <% if @event.photos.attached? %>
        <div id="carouselExampleControls" class="carousel slide flex-column" data-bs-ride="carousel">
          <div class="carousel-inner">
            <div class="carousel-item active">
              <%= cl_image_tag @event.photos.first.key, style: "height: auto; width: 100%;", crop: :fill %>
            </div>
            <% @event.photos.each do |photo| %>
              <div class="carousel-item">
                <%= cl_image_tag photo.key, style: "height: auto; width: 100%", crop: :fill %>
              </div>
            <% end %>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
          <%= simple_form_for([@event.group, @event], remote: true) do |f| %>
            <div class="form-group mt-4">
              <%= f.input :photos, as: :file, input_html: { multiple: true } %>
              <%= f.submit "Add photos", class: "btn btn-primary mb-3 w-100" %>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="col-6 d-flex flex-column">
        <%= simple_form_for([@event.group, @event], remote: true) do |f| %>
          <%= f.input :photos, as: :file, input_html: { multiple: true }, label: false %>
          <%= f.submit "Add your first photos!", class: "btn btn-primary mb-3 w-100" %>
        <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>
